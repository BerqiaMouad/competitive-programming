/*
                                                                                    
                                                  ████                              
                                                ██▓▓██                              
                                              ▒▒▓▓▒▒██                              
                              ██            ██▒▒▒▒▒▒██                              
                              ██          ▒▒▓▓▒▒▒▒▓▓██                              
                              ██▓▓      ▓▓▓▓▒▒▒▒▒▒████                              
                            ██▒▒██    ██▒▒▒▒▒▒▒▒██████        ██████████            
                            ██▒▒▒▒██  ██▒▒▒▒▒▒▒▒██████  ██████▒▒▒▒▒▒████            
                            ██▒▒▒▒████▒▒▒▒▒▒▒▒██████████▒▒▒▒▒▒▒▒████████            
                            ██▒▒▒▒████▒▒▒▒▒▒▒▒████████▓▓▒▒▒▒▒▒▓▓██████              
                          ▒▒▓▓▒▒▒▒████▒▒▒▒▒▒▓▓██████▓▓▒▒▒▒▓▓▓▓████████              
                          ██▒▒▒▒▒▒████▒▒▒▒████████████▓▓████████████                
                  ▓▓      ██▒▒▒▒▒▒████▒▒████████████████████████████                
                  ██▓▓    ██▒▒▒▒▓▓████████████████▓▓████████████████▓▓              
                  ██▓▓▓▓▓▓▓▓▒▒▒▒████████████▓▓▒▒▓▓████████████████████▓▓▓▓          
                  ██▒▒▓▓██▒▒▒▒▒▒██████████▒▒▒▒▒▒██████████████████████████▒▒▓▓      
                  ██▒▒▒▒▒▒▒▒▒▒▒▒██████████▒▒██████████████▓▓▓▓██████████████        
                    ██▒▒▒▒██▒▒▒▒████████▓▓██████████████▓▓████████████████          
                    ██▒▒▒▒████▒▒████████████████████████████████████████            
                      ██▒▒████████▓▓██████████████████████████████████              
                  ▓▓▓▓████▓▓████▒▒░░██████████▒▒██████████████████████▓▓            
                    ████████████▒▒░░░░██████▓▓▒▒▒▒██████▒▒████████████              
                      ████████████░░░░  ▒▒██▓▓▒▒▒▒████▒▒▒▒██████████                
                        ██████████░░░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒██████████                  
                        ██████████░░░░░░░░░░░░░░▒▒▒▒▒▒▒▒████████████                
                          ████████▒▒░░░░░░░░░░░░  ▒▒▒▒██▒▒████████                  
                          ██░░████▓▓▒▒    ░░░░░░  ▒▒▓▓██▒▒▓▓████░░                  
                          ██░░▒▒██▒▒▒▒▓▓▓▓▓▓▒▒▒▒▓▓▓▓████▒▒▒▒██                      
                          ██░░▒▒░░▒▒  ████▒▒▒▒▒▒▓▓██████▒▒▒▒██                      
                            ██░░    ▒▒████▒▒░░░░░░██▓▓██▒▒▒▒██                      
                              ▓▓▒▒░░░░░░░░░░░░░░░░████▒▒▒▒▓▓████▓▓                  
                                ██░░░░░░░░░░░░░░▒▒▒▒▒▒████  ░░░░░░██                
                              ▒▒▒▒▓▓░░░░░░░░░░░░▒▒▒▒▓▓░░░░░░░░░░  ▒▒▒▒              
                              ██▒▒▒▒▓▓▒▒░░  ▓▓▓▓▓▓▒▒██░░░░░░░░░░░░▒▒▒▒▓▓            
                              ██▒▒▒▒░░▓▓▓▓▒▒░░░░▒▒▓▓░░░░░░░░░░░░▒▒▒▒▒▒██            
              ▓▓██▓▓          ██▒▒▒▒  ░░▓▓▓▓▓▓▓▓▓▓██░░░░░░░░░░▒▒▒▒▒▒▒▒▒▒▓▓          
            ▓▓▒▒▒▒▒▒▓▓          ▓▓▒▒░░░░██▓▓▓▓▓▓████  ░░░░░░▒▒▒▒▒▒▒▒▒▒▒▒██          
    ▓▓▓▓▓▓▓▓██▓▓▓▓▒▒▒▒▓▓          ██    ██▓▓▒▒▓▓▓▓██▒▒▒▒░░░░░░▒▒▒▒▒▒▒▒▒▒██          
    ██░░░░░░░░██▓▓▒▒▒▒██▓▓▓▓▓▓▓▓▓▓██░░  ██▓▓▒▒▒▒▓▓██▒▒░░░░░░░░▒▒▒▒▓▓▓▓▓▓▒▒▓▓        
      ▓▓▓▓▓▓░░░░░░░░░░░░██▒▒▒▒▒▒▒▒██  ░░░░██▒▒▒▒██▒▒░░░░░░░░░░▒▒▒▒▓▓▓▓██▒▒▒▒▓▓      
░░██▓▓████▒▒▒▒  ░░  ░░░░░░██▒▒▒▒▒▒▒▒▓▓  ░░░░▒▒▒▒██░░  ░░░░░░░░▒▒▓▓▓▓▓▓▓▓▒▒▒▒██      
░░██  ░░░░░░░░░░░░░░░░░░░░▒▒████▒▒▒▒██  ░░░░  ██  ░░░░░░░░░░░░██▓▓▓▓▓▓▒▒▒▒▒▒██      
    ▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░██████▓▓▓▓▓▓████░░░░░░░░░░░░░░██▓▓▓▓▒▒▒▒▒▒▒▒██▓▓    
        ██▓▓▒▒▒▒  ░░░░▒▒▒▒░░░░░░░░░░░░░░░░░░▒▒▒▒░░░░░░  ░░░░▒▒▓▓████▒▒▒▒▒▒▒▒██▒▒▓▓  
          ██▒▒▒▒░░░░░░▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░▒▒  ░░░░░░▒▒▒▒▒▒████▒▒██▒▒▒▒▒▒██▒▒██  
            ██████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒██▒▒▒▒▒▒██████▒▒▒▒▒▒██
                ░░  ░░░░      ████░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██
          ░░  ░░░░░░░░░░░░░░░░    ████░░░░  ░░░░░░░░░░░░▒▒▒▒██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██
            ░░░░░░░░░░░░░░░░░░░░░░  ░░██▒▒░░░░░░░░░░░░░░▒▒██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░  
              ░░░░░░░░░░░░░░░░░░░░░░░░██████▒▒▒▒▒▒▒▒░░░░██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒      
                  ░░░░░░░░░░░░░░░░░░██  ░░  ██████▒▒░░░░██▒▒    ▒▒▒▒▒▒▒▒▒▒          
                        ░░░░░░░░░░░░██    ░░░░    ██████▒▒▒▒▒▒▒▒                    
                            ░░░░▓▓▓▓██            ░░░░░░▒▒▒▒▒▒░░            
*/


#include <bits/stdc++.h>
using namespace std;

typedef long long ll;
#define all(c) c.begin(), c.end()


int main(){
	ios_base::sync_with_stdio(0);
	cin.tie(0);

	#ifndef ONLINE_JUDGE

	freopen("in.txt", "r", stdin);
	freopen("out.txt", "w", stdout);

	#endif

	ll t; cin >> t;
	while(t--){
		ll n; cin >> n;
		vector<pair<ll, ll>>a(n);
		vector<ll> pref(n);
		for(ll i = 0; i< n; i++){
			cin >> a[i].first;
			a[i].second = i;
			if(i == 0)
				pref[i] = a[i].first;
			else 
				pref[i] = pref[i - 1] + a[i].first;
		}

		sort(all(a));

		vector<bool> vis(n, false);
		
		ll res = 0;
		ll i = 0, j = n - 1;
		while(i < j){
			if(vis[a[i].second]){
				i++;
				continue;
			}
			if(vis[a[j].second]){
				j--;
				continue;
			}

			ll mx = max(a[i].second, a[j].second);
			ll mn = min(a[i].second, a[j].second);
				
			if((a[j].first - a[i].first) * (max(a[i].second, a[j].second) - min(a[i].second, a[j].second) + 1) < 
				pref[mx] - pref[mn] + (a[i].second == mn ? a[i].first: a[j].first)){
				
				i++, j--;
				continue;
			}

			for(int k = min(a[i].second, a[j].second); k <= max(a[i].second, a[j].second); k++){
				vis[k] = true;
			}


			res += max((a[j].first - a[i].first) * (max(a[i].second, a[j].second) - min(a[i].second, a[j].second) + 1), 
				pref[mx] - pref[mn] + (a[i].second == mn ? a[i].first: a[j].first));
		}
		for(auto it: a){
			if(!vis[it.second])
				res += it.first;
		}
		cout << max(res, pref[n - 1]) << "\n";
	}

	return 0;
}
